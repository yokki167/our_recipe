<% if user_signed_in? && current_user.id == @recipe.user_id %>
  <div class="recipeManage">
    <%= link_to "編集", edit_recipe_path(@recipe.id), class: "recipeManage__edit" %>
    <%= link_to "削除", recipe_path(@recipe.id), method: :delete, class: "recipeManage__delete" %>
  </div>
<% end %>


<div class="show--wrapper">
  <div class="top--wrapper">
    <div class="top--wrapper__left">
      <div class="top--wrapper__left__recipename">
         <%= @recipe.title %>
      </div>


      <div class="postAuthor">
        by:<%= link_to @recipe.user.nickname, user_path(@recipe.user), class: "nickname-deco" %>
      </div>

      <div class="top--wrapper__left__time">
        <div class="top--wrapper__left__time__worktime">
          調理時間:<%= @recipe.worktime %>分
        </div>
        <div class="top--wrapper__left__time__byEatTime">
          食べるまで:<%= @recipe.time %>分
        </div>
      </div>


      <div class="top--wrapper__left__oneword">
        <%= @recipe.oneword %>
      </div>
      <div class="top--wrapper__left__likewrapper">
        <div class="top--wrapper__left__likewrapper__count">
          いいね数 : <%= @recipe.likes.count %>
        </div>
        <div class="top--wrapper__left__likewrapper__btn">
          <% if user_signed_in? %>
            <% if current_user.already_liked?(@recipe) %>
              <%= button_to 'いいねを取り消す', recipe_like_path(@recipe), method: :delete %>
            <% else %>
              <%= button_to 'いいね', recipe_likes_path(@recipe) %>
            <% end %>
          <% end %>
        </div>
      </div>



    </div>
    <div class="top--wrapper__right">
      <div class="top--wrapper__right__photo">
        <a href="/recipes/<%= @recipe.id %>">
        <%= image_tag @recipe.image.to_s, class: "photosize" %>
        </a>
      </div>
      <div class="top--wrapper__right__created">
        <%= @recipe.created_at %>
      </div>
    </div>
  </div>
  <div class="middle--wrapper">
    <div class="middle--wrapper__left">
      <div class="middle--wrapper__left__top">
        <div class="middle--wrapper__left__top__text">
          材料
        </div>
        <div class="middle--wrapper__left__top__serve">
          <%= @recipe.serving %> 人前
        </div>
      </div>
      <% @recipe.ingredients.each do |ingr| %>
        <div class="middle--wrapper__left__ingre">
          <div class="middle--wrapper__left__ingre__iname">
            <%= ingr.iname %>
          </div>
          <div class="middle--wrapper__left__ingre__amount">
            <%= ingr.amount %>
          </div>
        </div>
      <% end %> 
    </div>
    <div class="middle--wrapper__right">
      <div class="middle--wrapper__right__top">
        <form>
          <%# <div class="middle--wrapper__right__top__form">  %>
            <input id="keyword" type= "number">
          <%# </div> %>
          <%# <div class="middle--wrapper__right__top__btn"> %>
            <button id = "button">人前を表示</button>
          <%# </div> %>
        </form>
      </div>
      <div class="middle--wrapper__right__calcamount">
        <div class ="result"></div>
      </div>
    </div>
  </div>
  <div class="bottom--wrapper">
    <div class="bottom--wrapper__howto">作り方</div>
    <div class="bottom--wrapper__wrapper">
      <% @recipe.recipelists.each_with_index do |recipelist, i| %>
        <div class="bottom--wrapper__wrapper__list">
          <div class="bottom--wrapper__wrapper__list__count">
            <%= i + 1 %>
          </div>
          <% if recipelist.image.present? %>
            <div class="bottom--wrapper__wrapper__list__image">          
              <%= image_tag recipelist.image.to_s, class: "photolist" %>
            </div>
          <% end %>
          <div class="bottom--wrapper__wrapper__list__text">
            <%= recipelist.text %>
          </div>
        </div>
  <% end %>
    </div>
    <div class="point1">
      point!!
    </div>
    <div class="point">
      <div class="point--main">
        <%= @recipe.point %>
      </div>
    </div>
  </div>
</div>



<script>
var pattern = /\//;
var pattern2 = /\./;

var zairyo = $('.middle--wrapper__left__top__serve').text()
zairyo = zairyo.replace(/[^\d]/g, "");

$(function(){

  let btn = $("#button");
  let changeText = $('.middle--wrapper__left__ingre__amount');
  $('#button').click(function(e) {
    e.preventDefault();
    let input = $("#keyword").val();
    var array = [];


$(function(){
   $(".result").empty();
    $.each(array, function(index, value){
         $(".result").append(value).append('<br />');
    })
});
  $('.middle--wrapper__left__ingre__amount').each(function() {
    fff = $(this).text()

    if ((fff).match(pattern)){
    console.log('分数');
    result = fff.replace(/\//,"9999999")
    result = result.replace(/[^\d]/g, "");
    result = result.replace(/9999999/, "/");
    var bef = (result.slice(0,1))
      bef = bef / zairyo * input * 100;
      bef = Math.round(bef);
      bef = bef / 100;
    var aft = (result.slice(2))

    var sum = bef / aft
    sum = sum * 10;
    sum = Math.round(sum);
    sum = sum / 10
    ttt = fff.replace(/[\d]/g, "");
    ttt = ttt.replace(/\//, "pp");
    ggg = ttt.replace(/pp/,sum);
    console.log(ggg);

    array.push(ggg);

  } else if ((fff).match('適量')){
    ggg = fff
    console.log(ggg)
    array.push(ggg);
    
  } else if ((fff).match('種類')){
    ggg = fff
    console.log(ggg)
    array.push(ggg);


    
  } else if ((fff).match('少々')){
    ggg = fff
    console.log(ggg)
    array.push(ggg);

  } else if ((fff).match('ひと')){
    ggg = fff
    console.log(ggg)
    array.push(ggg);
    
  } else if ((fff).match('お好み')){
    ggg = fff
    console.log(ggg)
    array.push(ggg);

  } else if ((fff).match('好き')){
    ggg = fff
    console.log(ggg)
    array.push(ggg);


    
  } else if ((fff).match('半')){
      console.log(fff)
      fff = 0.5
      fff = fff / zairyo
      fff = fff * 10
      fff = Math.round(fff, 1);
      console.log(fff)
      fff = fff / 10
      fff = fff * input
      fff = Math.round(fff, 1);
      ggg = fff
      console.log(ggg)
      array.push(ggg);
  } 
  
    else if ((fff).match(pattern2)){
      console.log('少数だよ')
      var result = fff.replace(/[^\d]/g, "");
      result = result / 10
      result = result / zairyo
      result = result * 10
      result = Math.round(result);
      result = result / 10
      result = result * input
      result = result * 10
      result = Math.round(result);
      result = result / 10
    ttt = fff.replace(/[\d]/g, "");
    ttt = ttt.replace(/\./, "pp");
    ggg = ttt.replace(/pp/,result);
    console.log(ggg);
      array.push(ggg);
  } 

  else {
    console.log('整数だよ');
    var result = fff.replace(/[^\d]/g, "");

      result = result / zairyo
      result = result * 10
      result = Math.round(result);
      result = result / 100
      result = result * input
      result = result * 100
      result = Math.round(result);
      result = result / 10

    if (result == 0){
      console.log('エラーです');
      array.push(ggg);

    } else {
      ttt = fff.replace(/[\d]+/, "pppopo");
      var ggg = ttt.replace(/pppopo/,result);
      console.log(ggg);
      array.push(ggg);

    };
  }
  });
      
  });
  });
</script>
